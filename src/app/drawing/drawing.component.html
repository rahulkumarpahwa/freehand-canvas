<div class="relative h-screen overflow-hidden bg-gray-100">
  <!-- Drag and Drop Overlay -->
  <div
    *ngIf="isDragging"
    class="absolute inset-0 z-50 flex align-items-center justify-content-center bg-primary-100"
    style="background-color: rgba(59, 130, 246, 0.2); border: 3px dashed #3b82f6;"
  >
    <div class="text-center">
      <i class="pi pi-upload text-6xl text-primary mb-3"></i>
      <p class="text-xl font-bold text-primary">Drop SVG file here to import</p>
    </div>
  </div>


    
      <button
      pButton
      icon="pi pi-bars"
      class="absolute top-0 left-0 shadow-none"
      (click)="sidebarOpen = !sidebarOpen"
      [class.p-button-outlined]="!sidebarOpen"
      class="fixed top-0 left-0 shadow-none overflow-hidden"
      [title]="sidebarOpen ? 'Close Settings' : 'Open Settings'"
      ></button>

  <div
    class="absolute top-0 left-0 w-full z-10 flex flex-column align-items-center p-3 pointer-events-none"
  >
    <div
      class="flex gap-2 bg-white shadow-4 border-round-xl p-2 pointer-events-auto align-items-center"
    >
      <button
        pButton
        icon="pi pi-pencil"
        label="Pen 1"
        [class.p-button-outlined]="activeTool !== 'pen1'"
        (click)="activeTool = 'pen1'"
      ></button>
      <button
        pButton
        icon="pi pi-pencil"
        label="Pen 2"
        [class.p-button-outlined]="activeTool !== 'pen2'"
        (click)="activeTool = 'pen2'"
        class="p-button-secondary"
      ></button>
      <button
        pButton
        icon="pi pi-pencil"
        label="Highlighter"
        [class.p-button-outlined]="activeTool !== 'highlighter'"
        (click)="activeTool = 'highlighter'"
        class="p-button-help"
      ></button>

      <button
        pButton
        icon="pi pi-eraser"
        label="Eraser"
        [class.p-button-outlined]="activeTool !== 'eraser'"
        (click)="activeTool = 'eraser'"
        class="p-button-warning"
      ></button>

      <div class="border-left-1 border-300 h-2rem mx-2"></div>
         <button
        pButton
        icon="pi pi-upload"
        (click)="triggerFileInput()"
        class="p-button-text p-button-plain"
        title="Import SVG"
      ></button>
 <div class="border-left-1 border-300 h-2rem mx-2"></div>
      <button
        pButton
        icon="pi pi-chevron-left"
        (click)="undo()"
        [disabled]="allStrokes.length === 0"
        class="p-button-text p-button-plain"
        title="Undo"
      ></button>
      <button
        pButton
        icon="pi pi-chevron-right"
        (click)="redo()"
        [disabled]="redoStack.length === 0"
        class="p-button-text p-button-plain"
        title="Redo"
      ></button>
      <div class="border-left-1 border-300 h-2rem mx-2"></div>
      <button
        pButton
        icon="pi pi-times"
        (click)="clearCanvas()"
        class="p-button-text p-button-danger"
        title="Clear All"
      ></button>
      <button
        pButton
        icon="pi pi-download"
        (click)="saveSVG()"
        class="p-button-text p-button-plain"
        title="Download SVG"
      ></button>
      <button
        pButton
        [icon]="isSending ? 'pi pi-spin pi-spinner' : 'pi pi-send'"
        (click)="sendToApi()"
        [disabled]="isSending || allStrokes.length === 0"
        class="p-button-text p-button-plain"
        title="Send to API"
      ></button>
   
     
      <input
        #fileInput
        type="file"
        accept=".svg,image/svg+xml"
        (change)="onFileSelected($event)"
        style="display: none"
      />
    </div>

    <div
      *ngIf="sidebarOpen && activeTool !== 'eraser'"
      class="mt-6 z-10 shadow-2 text-sm border-round-lg p-2 mx-1 overflow-y-auto absolute top-0 left-0 pointer-events-auto"
      style="max-height: calc(100vh - 80px); margin-top: 60px; background-color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px); width: fit-content;"
    >
      <div class="flex justify-content-between align-items-center mb-3">
        <span class="font-bold uppercase text-500"
          >{{ activeTool }}</span
        >
        <button
          pButton
          icon="pi pi-refresh"
          label="Reset Pen"
          class="p-button-xs p-button-text p-button-secondary"
          (click)="resetPenSettings()"
        ></button>
      </div>

      <div class="flex flex-column gap-3 mb-4">
        <div class="flex align-items-center gap-1">
          <label>Size</label>
          <input
            type="range"
            min="1"
            max="100"
            [(ngModel)]="tools[activeTool].size"
          />
          <span class="val">{{ tools[activeTool].size }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Thinning</label>
          <input
            type="range"
            min="0"
            max="1"
            step="0.01"
            [(ngModel)]="tools[activeTool].thinning"
          />
          <span class="val">{{ tools[activeTool].thinning }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Streamline</label>
          <input
            type="range"
            min="0"
            max="1"
            step="0.01"
            [(ngModel)]="tools[activeTool].streamline"
          />
          <span class="val">{{ tools[activeTool].streamline }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Smoothing</label>
          <input
            type="range"
            min="0"
            max="1"
            step="0.01"
            [(ngModel)]="tools[activeTool].smoothing"
          />
          <span class="val">{{ tools[activeTool].smoothing }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Easing</label>
          <select [(ngModel)]="tools[activeTool].easing">
            <option *ngFor="let opt of easingOptions" [value]="opt.value">
              {{ opt.label }}
            </option>
          </select>
        </div>
      </div>

      <hr class="border-200" />

      <div class="flex flex-column gap-3 my-4">
        <div class="flex align-items-center gap-1">
          <label>Taper Start</label>
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="tools[activeTool].start.taper"
          />
          <span class="val">{{ tools[activeTool].start.taper }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Easing Start</label>
          <select [(ngModel)]="tools[activeTool].start.easing">
            <option *ngFor="let opt of easingOptions" [value]="opt.value">
              {{ opt.label }}
            </option>
          </select>
        </div>
      </div>

      <hr class="border-200" />

      <div class="flex flex-column gap-3 my-4">
        <div class="flex align-items-center gap-1">
          <label>Taper End</label>
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="tools[activeTool].end.taper"
          />
          <span class="val">{{ tools[activeTool].end.taper }}</span>
        </div>
        <div class="flex align-items-center gap-1">
          <label>Easing End</label>
          <select [(ngModel)]="tools[activeTool].end.easing">
            <option *ngFor="let opt of easingOptions" [value]="opt.value">
              {{ opt.label }}
            </option>
          </select>
        </div>
      </div>

      <hr class="border-200" />

      <div class="flex flex-column gap-3 mt-4">
        <div class="flex align-items-center justify-content-between">
          <label class="">Fill Color</label>
          <input
            type="color"
            [(ngModel)]="tools[activeTool].color"
            class="w-3rem h-2rem border-none cursor-pointer"
          />
        </div>
        <div class="flex align-items-center gap-1">
          <label>Stroke Width</label>
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="tools[activeTool].outline.width"
          />
          <span class="val">{{ tools[activeTool].outline.width }}</span>
        </div>
        <div class="flex align-items-center justify-content-between">
          <label class="">Stroke Color</label>
          <input
            type="color"
            [(ngModel)]="tools[activeTool].outline.color"
            class="w-3rem h-2rem border-none cursor-pointer"
          />
        </div>
      </div>
    </div>
  </div>

  <svg
    #svgElement
    class="w-full h-full bg-white touch-none"
    (pointerdown)="onPointerDown($event)"
    (pointermove)="onPointerMove($event)"
    (pointerup)="onPointerUp()"
  >
    <g *ngFor="let s of allStrokes">
      <path
        [attr.d]="s.path"
        [attr.fill]="s.color"
        [attr.fill-opacity]="s.opacity"
        [attr.stroke]="s.outlineColor"
        [attr.stroke-width]="s.outlineWidth"
        stroke-linejoin="round"
      />
    </g>
    <path
      *ngIf="previewPath"
      [attr.d]="previewPath"
      [attr.fill]="tools[activeTool].color"
      [attr.fill-opacity]="tools[activeTool].opacity"
      [attr.stroke]="tools[activeTool].outline.color"
      [attr.stroke-width]="tools[activeTool].outline.width"
      stroke-linejoin="round"
    />
  </svg>
</div>
